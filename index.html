<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>思维协同处理器 - 智能解析增强版</title>
    
    <!-- 元数据 -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <meta name="description" content="思维协同处理器 - 个人知识管理与思维模型构建工具，帮助你结构化思考、管理认知模型、建立个人知识体系">
    <meta name="keywords" content="知识管理,思维模型,认知工具,个人成长,思维训练">
    <meta name="author" content="Aha">
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="mobile.css">
    
    <style>
        /* 临时样式用于调试 */
        .debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 9999;
            font-size: 12px;
            max-width: 300px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- 调试信息 -->
    <div class="debug-info" id="debug-info"></div>
    
    <!-- 桌面端顶部栏 -->
    <div class="top-bar desktop-only">
        <div class="logo">
            <div class="logo-icon">🧠</div>
            <div class="logo-text">思维协同处理器</div>
        </div>
        <div class="system-info">
            <span>当前版本: <strong id="current-version">v22.48</strong></span>
            <span style="margin: 0 5px;">|</span>
            <span>模型总数: <strong id="total-models">0</strong></span>
            <span style="margin: 0 5px;">|</span>
            <span>思考记录: <strong id="total-thoughts">0</strong></span>
            <span style="margin: 0 5px;">|</span>
            <span>标签数: <strong id="total-tags">0</strong></span>
        </div>
        <div class="sync-controls">
            <button class="sync-btn" id="sync-btn" title="同步数据">
                <i class="fas fa-sync-alt"></i> 同步
            </button>
            <button class="sync-btn" id="export-btn" title="导出数据">
                <i class="fas fa-download"></i> 导出
            </button>
            <button class="sync-btn" id="github-export-btn" title="导出到GitHub文件" onclick="GitHubDataSync.exportDataForGitHub()">
                <i class="fas fa-cloud-upload-alt"></i> GitHub
            </button>
        </div>
        <div class="current-view" id="current-view">核心资产总览</div>
    </div>
    
    <!-- 移动端顶部导航 -->
    <div class="mobile-header">
        <div class="mobile-header-inner">
            <div class="mobile-header-left">
                <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <div class="mobile-logo">
                    <span class="mobile-logo-icon">🧠</span>
                    <span class="mobile-logo-text">思维协同</span>
                </div>
            </div>
            
            <div class="mobile-header-right">
                <button class="mobile-search-toggle" id="mobile-search-toggle">
                    <i class="fas fa-search"></i>
                </button>
                <button class="mobile-view-toggle" id="mobile-view-toggle">
                    <i class="fas fa-th-large"></i>
                </button>
            </div>
        </div>
        
        <!-- 移动端搜索框 -->
        <div class="mobile-search-bar" id="mobile-search-bar">
            <div class="mobile-search-input">
                <i class="fas fa-search"></i>
                <input type="text" id="mobile-search-input" placeholder="搜索思考记录或模型...">
                <button class="mobile-search-clear" id="mobile-search-clear">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <!-- 移动端快捷视图切换 -->
        <div class="mobile-view-switcher" id="mobile-view-switcher">
            <div class="mobile-view-options">
                <button class="mobile-view-option active" data-view="overview">
                    <i class="fas fa-chart-pie"></i>
                    <span>概览</span>
                </button>
                <button class="mobile-view-option" data-view="thoughts">
                    <i class="fas fa-list-ul"></i>
                    <span>思考</span>
                </button>
                <button class="mobile-view-option" data-view="models">
                    <i class="fas fa-cube"></i>
                    <span>模型</span>
                </button>
                <button class="mobile-view-option" data-view="keywords">
                    <i class="fas fa-tags"></i>
                    <span>标签</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- 主容器 -->
    <div class="main-container">
        <!-- 左侧导航栏 -->
        <div class="sidebar">
            <div class="nav-section">
                <h3><i class="fas fa-compass"></i> 核心导航</h3>
                <ul class="nav-links">
                    <li><a href="#" class="active" data-view="overview"><i class="fas fa-chart-pie"></i> 核心资产总览</a></li>
                    <li><a href="#" data-view="add-structured"><i class="fas fa-plus-circle"></i> 结构化输入思考</a></li>
                    <li><a href="#" data-view="thoughts"><i class="fas fa-list-ul"></i> 思考目录完整清单</a></li>
                    <li><a href="#" data-view="models"><i class="fas fa-cube"></i> 核心思维模型索引</a></li>
                    <li><a href="#" data-view="add-model"><i class="fas fa-plus-square"></i> 创建思维模型</a></li>
                    <li><a href="#" data-view="keywords"><i class="fas fa-search"></i> 标签分类检索</a></li>
                    <li><a href="#" data-view="network-analysis"><i class="fas fa-project-diagram"></i> 模型关联网络分析</a></li>
                    <li><a href="#" data-view="timeline"><i class="fas fa-road"></i> 系统演进历程</a></li>
                </ul>
            </div>
            
            <div class="nav-section">
                <h3><i class="fas fa-tools"></i> 系统工具</h3>
                <ul class="nav-links">
                    <li><a href="#" data-view="how-to-use"><i class="fas fa-question-circle"></i> 如何使用本系统</a></li>
                    <li><a href="#" data-view="milestones"><i class="fas fa-road"></i> 系统演进里程碑</a></li>
                    <li><a href="#" data-view="architecture"><i class="fas fa-sitemap"></i> 系统架构特性</a></li>
                    <li><a href="#" data-view="tag-review"><i class="fas fa-tags"></i> 标签复核中心</a></li>
                    <li><a href="#" data-view="data-management"><i class="fas fa-database"></i> 数据管理与备份</a></li>
                </ul>
            </div>
            
            <div class="version-selector">
                <label for="version-select">数据版本:</label>
                <select id="version-select">
                    <option value="initial">初始版本</option>
                    <option value="current" selected>当前版本</option>
                </select>
            </div>
        </div>
        
        <!-- 主内容区 -->
        <div class="content-area" id="content-area">
            <div id="loading" class="loading" style="margin: 100px auto;"></div>
        </div>
        
        <!-- 右侧面板 -->
        <div class="right-panel">
            <div class="search-section">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="搜索思考记录或模型...">
                </div>
                <div class="filter-options">
                    <select id="category-filter">
                        <option value="all">所有类别</option>
                        <option value="thought">思考记录</option>
                        <option value="model">思维模型</option>
                    </select>
                </div>
            </div>
            
            <div class="status-section">
                <h3><i class="fas fa-heartbeat"></i> 系统状态</h3>
                <div class="status-item">
                    <span class="status-label">最后保存</span>
                    <span class="status-value" id="last-saved">刚刚</span>
                </div>
                <div class="status-item">
                    <span class="status-label">数据完整</span>
                    <span class="status-value" id="data-integrity">100%</span>
                </div>
                <div class="status-item">
                    <span class="status-label">存储模式</span>
                    <span class="status-value" id="storage-mode">本地存储</span>
                </div>
            </div>
            
            <div class="network-section">
                <h3><i class="fas fa-project-diagram"></i> 模型关联网络</h3>
                <div class="network-graph" id="right-panel-network">
                    <div style="text-align: center; padding: 30px; color: #666;">
                        <i class="fas fa-project-diagram" style="font-size: 24px;"></i>
                        <p style="margin-top: 10px; font-size: 14px;">模型关联网络</p>
                    </div>
                </div>
            </div>
            
            <div class="data-section">
                <h3><i class="fas fa-database"></i> 数据操作</h3>
                <div class="data-actions">
                    <button class="data-btn export" id="export-all-btn">
                        <i class="fas fa-download"></i> 导出全部数据
                    </button>
                    <button class="data-btn import" id="import-data-btn">
                        <i class="fas fa-upload"></i> 导入数据文件
                    </button>
                    <button class="data-btn backup" id="github-export-btn">
                        <i class="fab fa-github"></i> 导出到GitHub
                    </button>
                </div>
            </div>
            
            <div class="how-to-use">
                <h3><i class="fas fa-question-circle"></i> 使用提示</h3>
                <ul class="steps-list">
                    <li><strong>电脑端</strong>：完整的数据编辑和管理功能</li>
                    <li><strong>移动端</strong>：数据浏览和搜索功能</li>
                    <li><strong>数据同步</strong>：电脑端导出 → 移动端导入</li>
                    <li><strong>数据安全</strong>：所有数据保存在浏览器本地</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- 移动端底部导航 -->
    <div class="mobile-bottom-nav">
        <div class="mobile-bottom-nav-inner">
            <a href="#" class="mobile-nav-item active" data-view="overview">
                <i class="fas fa-home"></i>
                <span>首页</span>
            </a>
            <a href="#" class="mobile-nav-item" data-view="thoughts">
                <i class="fas fa-brain"></i>
                <span>思考</span>
            </a>
            <a href="#" class="mobile-nav-item" data-view="models">
                <i class="fas fa-cubes"></i>
                <span>模型</span>
            </a>
            <a href="#" class="mobile-nav-item" data-view="keywords">
                <i class="fas fa-tags"></i>
                <span>标签</span>
            </a>
        </div>
    </div>
    
    <!-- 模态框 -->
    <div id="delete-modal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <h3>确认删除</h3>
            <p id="delete-message">确定要删除此项吗？</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="App.closeModal('delete-modal')">取消</button>
                <button class="btn btn-danger" onclick="App.confirmDelete()">删除</button>
            </div>
        </div>
    </div>

    <!-- JavaScript 文件 -->
    <script src="script.js"></script>
    <script src="mobile-config.js"></script>
    <script src="mobile.js"></script>
    <script src="data-sync.js"></script>
    <script>
        // 调试模式
        const DEBUG = false;
        
        // 修复版：安全的初始化应用
        function initializeApp() {
            console.log('尝试初始化应用...');
            
            // 检查App对象是否已定义
            if (typeof App === 'undefined') {
                console.error('错误：App对象未定义');
                
                // 显示用户友好的错误信息
                const contentArea = document.getElementById('content-area');
                if (contentArea) {
                    contentArea.innerHTML = `
                        <div class="error-state" style="text-align:center; padding:100px 20px;">
                            <h2>系统初始化失败</h2>
                            <p style="color:#666; margin:15px 0;">核心脚本加载失败，请检查：</p>
                            <ol style="text-align:left; max-width:400px; margin:20px auto; padding-left:20px;">
                                <li>script.js文件是否正确加载</li>
                                <li>浏览器控制台是否有错误信息</li>
                                <li>尝试刷新页面或清除缓存</li>
                            </ol>
                            <div style="margin-top:30px;">
                                <button onclick="location.reload()" class="btn btn-primary" style="padding:10px 20px; background:#5c6bc0; color:white; border:none; border-radius:6px; cursor:pointer;">
                                    刷新页面
                                </button>
                            </div>
                        </div>
                    `;
                }
                return false;
            }
            
            // 检查App.init是否存在
            if (typeof App.init !== 'function') {
                console.error('错误：App.init不是函数');
                return false;
            }
            
            try {
                console.log('开始初始化App...');
                App.init();
                console.log('App初始化成功');
                return true;
            } catch (error) {
                console.error('初始化过程中出错:', error);
                return false;
            }
        }
        
        // 当DOM加载完成时尝试初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded事件触发');
            
            // 延迟执行，确保所有脚本都已加载
            setTimeout(function() {
                // 第一次尝试
                if (!initializeApp()) {
                    console.log('第一次初始化失败，5秒后重试...');
                    
                    // 5秒后重试
                    setTimeout(function() {
                        if (!initializeApp()) {
                            console.error('多次初始化尝试均失败');
                        }
                    }, 5000);
                }
            }, 500); // 增加延迟到500ms，确保script.js已加载
        });
        
        // 备用：当页面完全加载时也尝试初始化
        window.addEventListener('load', function() {
            console.log('window.load事件触发');
            
            // 如果还没初始化成功，再试一次
            if (typeof window.appInitialized === 'undefined') {
                setTimeout(initializeApp, 100);
            }
        });
    </script>
    
</body>
</html>
